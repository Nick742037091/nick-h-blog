---
title: 前端模块系统
published: 2025-02-10
description: '系统讲解各个场景下的前端模块'
image: '../../assets/images/articles/前端模块系统/nodejs.png'
tags: ['node.js','webpack','vite']
category: '前端'
lang: 'zh_CN'
---

现在普遍使用的前端模块基本就两种类型：[CommonJS](https://nodejs.org/docs/latest-v16.x/api/modules.html) 和 [ESM](https://nodejs.org/docs/latest-v16.x/api/esm.html)，但是细分到各种场景又会有很多注意事项，让我们梳理一下。


# Node.js

先展示一下 Commonjs 和 ESM 的基本用法。
## 示例
### CommonJS

导出使用 `module.exports` 或 `exports`
```js
// utils.js
// 整体导出为一个对象
module.exports = {
  fun: function() { },
  v1: 'xxxx'
}
// exports 为 module.exports 别名，相当于在 module.exports 导出的对象增加属性
exports.bar = function() { }
```

导入使用 `require`
```js
// 只能导入为完整对象
const utils = require('./utils.js')
//使用导入对象的属性
utils.fun()
console.log('v1', utils.v1)
```

### ESM

导出使用 `export`或`export default`。
```js
// utils.js
// 命名导出函数
export function fun() { }
// 命名导出常量
export const v1 = 'xxx'
function test () {
  console.log("test");
}
const v3 = 'zzz';
// 命名导出另一种写法，必须先定义再导出
export {
  test,
  v3
}
// 默认导出
export default {
  bar: function() { },
  v2: 'yyy'
}
```
:::tip
一个文件只能有一处默认导出，可以有多处命名导出，可以混合命名导出和默认导出
:::

导入使用`import`
```js
// 命名导入
import { fun, v1 } from './utils.js'
// 将所有命名导入合并为一个对象
import * obj from './utils.js'
// 默认导入
import utils from './utils.js'

fun()
console.log('v1', v1)

obj.fun()
console.log('v1', obj.v1)

utils.bar()
console.log('v2', utils.v2)
```
:::tip
支持导入多次，但是不要有重复的命名
:::

## 定义模块类型

那么，CommmonJS和ESM如何在Node.js中使用？
Node.js项目都有`package.json`文件，可以通过`type`属性设置支持的模块类型：
### CommmonJS
```json
{
  "type": "commonjs", // 设置CommmonJS模块，默认值  
}
```
设置为CommmonJS模块时，对于ESM文件，需要将文件后缀改为`mjs`才能导入。使用`动态import`进行导入。
```js
// a.mjs
export default function a() {
  console.log("a");
}
```
```js
//index.js
// CommmonJS为同步导入，ESM为异步导入，所以在CommonJS中导入ESM只能使用异步导入写法
import('./a.mjs').then(a => a.default());
```

### ESM
```json
{
  "type": "module", // 设置ESM模块
}
```
设置为ESM模块时，对于CommmonJS文件，需要将文件后缀改为`cjs`才能导入。使用`import`进行导入。

```js
// a.cjs
function a() {
  console.log("a");
}
module.exports = {
  a
};

```
```js
//index.js
import { a } from "./a.cjs";
a();
```
